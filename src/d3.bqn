#!/usr/bin/env cbqn

# -- Day 3 --
## - Part 1 -

# Any number adjacent to a symbol, even diagonally, is a "part number" and
# should be included in your sum.
# (Periods (.) do not count as a symbol.)
# What is the sum of all of the part numbers in the engine schematic?

d â† âŸ¨
  "467..114.."
  "...*......"
  "..35..633."
  "......#..."
  "617*......"
  ".....+.58."
  "..592....."
  "......755."
  "...$.*...."
  ".664.598.."
âŸ©
d â†© â€¢Flines"../data/d3.txt"
d >â†©
dshape â† â‰¢d
dvec â† â¥Šd

dgs â† '0'+â†•10
IsNum â† âˆŠâŸœdgs
numPos â† Ã—âŸœ{+` <ËË˜2â†• 0âˆ¾ğ•©} IsNum dvec # Number each string position.
nums â† â€¢ParseFloatÂ¨ 1â†“numPosâŠ”dvec

sym â† Â¬ (('.'âŠ¸=) âˆ¨ IsNum) d

# Reminiscent of Conway's Game of Life.
m â† 0â‰ Â·+Â´â¥ŠÂ¯1â€¿0â€¿1 (âŒ½â‰1)âŒœ Â¯1â€¿0â€¿1 âŒ½âŒœ <sym
validNumIds â† â·0âŠ¸<âŠ¸/numPosÃ—â¥Šm
+Â´(validNumIds-1)âŠnums

## - Part 2 -

# A gear is any * symbol that is adjacent to exactly two part
# numbers. Its gear ratio is the result of multiplying those
# two numbers together.
# What is the sum of all of the gear ratios in your engine
# schematic?
# gear â† '*'=d

# Quite ugly, but it did the trick :)

GetAdjNums â† {dWinğ•ŠnumPosWin:
  Pad â† âŠ¢â†‘ËÂ·â‰âŸœÂ¬2+â‰¢
  gear â† Pad '*'=dWin
  m â† 0â‰ Â·+Â´â¥ŠÂ¯1â€¿0â€¿1 (âŒ½â‰1)âŒœ Â¯1â€¿0â€¿1 âŒ½âŒœ <gear
  res â† (Pad numPosWin) Ã—â—‹â¥Š m
	unique â† â·Â·0âŠ¸â‰ âŠ¸/res

	{ (â‰ unique)=2 ?
    <(unique-1)âŠnums
		; <âŸ¨0âŸ©
	}
}

winD â† âˆ¾Ë3â€¿3âŠ¸â†•d
Windows â† {ğ•Šğ•©:
	# Only look at windows where * is in center.
  wins â† âˆ¾Ë3â€¿3âŠ¸â†•ğ•©
  mc â† {'*'=1â€¿1âŠ‘ğ•©}Ë˜winD
	mc/wins
}

adjNums â† d GetAdjNumsË˜â—‹Windows (dshapeâ¥ŠnumPos)
+Â´Ã—Â´Â¨adjNums

# Answer:
# 79844424

